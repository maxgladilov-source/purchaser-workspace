// messages-mock-data.ts — Моковые данные сообщений закупщика

export type MessageChannel = "operator" | "supplier" | "system";
export type ConversationStatus = "active" | "waiting" | "resolved";

export interface Message {
  id: string;
  from: string;
  fromRole: MessageChannel;
  text: string;
  timestamp: string;
  read: boolean;
}

export interface Conversation {
  id: string;
  subject: string;
  channel: MessageChannel;
  status: ConversationStatus;
  relatedOrder?: string;
  participants: string[];
  lastMessageAt: string;
  unreadCount: number;
  messages: Message[];
}

export const CHANNEL_CONFIG: Record<MessageChannel, { label: string; color: string }> = {
  operator: { label: "Оператор", color: "blue" },
  supplier: { label: "Поставщик", color: "green" },
  system: { label: "Система", color: "default" },
};

export const STATUS_CONFIG: Record<ConversationStatus, { label: string; color: string }> = {
  active: { label: "Активный", color: "green" },
  waiting: { label: "Ожидание", color: "orange" },
  resolved: { label: "Решён", color: "default" },
};

/** Вспомогательная функция: возвращает ISO-строку для «N часов назад» */
function ago(hours: number): string {
  return new Date(Date.now() - hours * 60 * 60 * 1000).toISOString();
}

export const MOCK_CONVERSATIONS: Conversation[] = [
  // ---- 1. Спор по качеству корпуса насоса (supplier) ----
  {
    id: "CONV-001",
    subject: "Спор по заказу ОРД-006 — отклонения по шероховатости",
    channel: "supplier",
    status: "active",
    relatedOrder: "ОРД-006",
    participants: ["Иванов А.С.", "ООО МеталлРесурс"],
    lastMessageAt: ago(2),
    unreadCount: 1,
    messages: [
      {
        id: "MSG-001-1",
        from: "Иванов А.С.",
        fromRole: "supplier",
        text: "Добрый день. Получили корпуса насоса по заказу ОРД-006. При входном контроле обнаружены отклонения по шероховатости внутренних поверхностей: фактическое значение Ra 3.2, по чертежу требуется Ra 1.6. Просим прокомментировать.",
        timestamp: ago(26),
        read: true,
      },
      {
        id: "MSG-001-2",
        from: "ООО МеталлРесурс",
        fromRole: "supplier",
        text: "Здравствуйте, Алексей Сергеевич. Спасибо за обратную связь. Проверим протоколы контроля с нашей стороны. Возможно, потребуется дополнительная чистовая обработка. Подготовим ответ в течение суток.",
        timestamp: ago(24),
        read: true,
      },
      {
        id: "MSG-001-3",
        from: "Иванов А.С.",
        fromRole: "supplier",
        text: "Хорошо, ждём. Прикладываю протокол измерений с профилограммами. Отклонение наблюдается на всех 5 корпусах, особенно на поверхностях внутренних каналов.",
        timestamp: ago(23),
        read: true,
      },
      {
        id: "MSG-001-4",
        from: "ООО МеталлРесурс",
        fromRole: "supplier",
        text: "Изучили протокол. Действительно, на внутренних каналах не удалось достичь Ra 1.6 из-за длины вылета инструмента. Готовы забрать детали на доработку за наш счёт. Срок — 5 рабочих дней. Либо можем обсудить скидку 15% если текущая шероховатость приемлема.",
        timestamp: ago(2),
        read: false,
      },
    ],
  },

  // ---- 2. Уточнение по лоту на CAD-проектирование (supplier) ----
  {
    id: "CONV-002",
    subject: "Уточнение ТЗ по лоту LOT-009 — рама конвейера",
    channel: "supplier",
    status: "active",
    relatedOrder: "LOT-009",
    participants: ["Иванов А.С.", "ООО ТочМех"],
    lastMessageAt: ago(5),
    unreadCount: 0,
    messages: [
      {
        id: "MSG-002-1",
        from: "ООО ТочМех",
        fromRole: "supplier",
        text: "Алексей Сергеевич, здравствуйте. По лоту LOT-009 на проектирование рамы конвейера хотели бы уточнить несколько моментов: 1) Какой тип ленты планируется? 2) Производительность конвейера (т/ч)? 3) Есть ли требования по агрессивной среде (пыль, влажность, температура)?",
        timestamp: ago(48),
        read: true,
      },
      {
        id: "MSG-002-2",
        from: "Иванов А.С.",
        fromRole: "supplier",
        text: "Здравствуйте. Отвечаю по пунктам: 1) Лента конвейерная резинотканевая БКНЛ-65, ширина 650 мм. 2) Производительность 50 т/ч, насыпной груз — щебень фр. 20-40. 3) Эксплуатация на открытом воздухе, температура от -30 до +40\u00B0С, без агрессивных сред.",
        timestamp: ago(44),
        read: true,
      },
      {
        id: "MSG-002-3",
        from: "ООО ТочМех",
        fromRole: "supplier",
        text: "Благодарим за подробную информацию. С учётом открытой эксплуатации рекомендуем горячее цинкование рамы. Скорректируем предложение и обновим стоимость в течение дня.",
        timestamp: ago(5),
        read: true,
      },
    ],
  },

  // ---- 3. Помощь оператора по работе с платформой (operator) ----
  {
    id: "CONV-003",
    subject: "Как настроить автоматическое уведомление о новых предложениях?",
    channel: "operator",
    status: "resolved",
    participants: ["Иванов А.С.", "Оператор платформы"],
    lastMessageAt: ago(72),
    unreadCount: 0,
    messages: [
      {
        id: "MSG-003-1",
        from: "Иванов А.С.",
        fromRole: "operator",
        text: "Добрый день. Подскажите, как настроить уведомления на email при поступлении новых предложений по моим лотам? Не могу найти эту функцию.",
        timestamp: ago(96),
        read: true,
      },
      {
        id: "MSG-003-2",
        from: "Оператор платформы",
        fromRole: "operator",
        text: "Здравствуйте, Алексей Сергеевич! Для настройки уведомлений перейдите в раздел \u00ABНастройки\u00BB \u2192 \u00ABУведомления\u00BB. Там можно выбрать события (новое предложение, изменение статуса заказа, сообщения) и каналы доставки (email, Telegram, push). Рекомендуем также включить уведомление об окончании срока сбора предложений.",
        timestamp: ago(94),
        read: true,
      },
      {
        id: "MSG-003-3",
        from: "Иванов А.С.",
        fromRole: "operator",
        text: "Нашёл, спасибо! Всё настроил. Ещё вопрос: можно ли добавить второго пользователя от нашей компании для просмотра заказов?",
        timestamp: ago(93),
        read: true,
      },
      {
        id: "MSG-003-4",
        from: "Оператор платформы",
        fromRole: "operator",
        text: "Да, конечно. В разделе \u00ABНастройки\u00BB \u2192 \u00ABКоманда\u00BB вы можете пригласить коллег по email. Доступны роли: \u00ABАдминистратор\u00BB (полный доступ), \u00ABЗакупщик\u00BB (создание лотов и заказов), \u00ABНаблюдатель\u00BB (только просмотр). Каждая роль имеет свой набор прав.",
        timestamp: ago(72),
        read: true,
      },
    ],
  },

  // ---- 4. Системное уведомление — завершение сбора предложений (system) ----
  {
    id: "CONV-004",
    subject: "Сбор предложений по лоту LOT-002 завершён",
    channel: "system",
    status: "resolved",
    relatedOrder: "LOT-002",
    participants: ["Иванов А.С.", "Система"],
    lastMessageAt: ago(120),
    unreadCount: 0,
    messages: [
      {
        id: "MSG-004-1",
        from: "Система",
        fromRole: "system",
        text: "Уведомление: сбор предложений по лоту LOT-002 \u00ABКожухи для вентиляционной системы\u00BB завершён. Получено 3 предложения. Лот переведён в статус \u00ABОценка\u00BB. Перейдите в раздел \u00ABЛоты\u00BB для сравнения предложений и выбора поставщика.",
        timestamp: ago(120),
        read: true,
      },
    ],
  },

  // ---- 5. Обсуждение доставки с поставщиком (supplier) ----
  {
    id: "CONV-005",
    subject: "Доставка заказа ОРД-002 — детали каркаса",
    channel: "supplier",
    status: "waiting",
    relatedOrder: "ОРД-002",
    participants: ["Иванов А.С.", "ООО ЛистПром"],
    lastMessageAt: ago(8),
    unreadCount: 2,
    messages: [
      {
        id: "MSG-005-1",
        from: "ООО ЛистПром",
        fromRole: "supplier",
        text: "Алексей Сергеевич, здравствуйте. Заказ ОРД-002 полностью готов. 45 наименований деталей — все позиции укомплектованы. Хотели бы согласовать способ доставки: можем отправить \u00ABДеловыми Линиями\u00BB или \u00ABПЭК\u00BB. Какой вариант предпочтительнее?",
        timestamp: ago(30),
        read: true,
      },
      {
        id: "MSG-005-2",
        from: "Иванов А.С.",
        fromRole: "supplier",
        text: "Добрый день. Отправляйте \u00ABДеловыми Линиями\u00BB, терминал в нашем городе ближе к складу. Упаковка — обрешётка, детали не должны деформироваться при транспортировке. Адрес: г. Москва, ул. Промышленная, 15, склад 3.",
        timestamp: ago(28),
        read: true,
      },
      {
        id: "MSG-005-3",
        from: "ООО ЛистПром",
        fromRole: "supplier",
        text: "Принято. Упаковываем в деревянную обрешётку, прокладки из вспененного полиэтилена. Отправим завтра утром. Ориентировочный срок доставки — 3-4 рабочих дня. Трек-номер пришлю после отгрузки.",
        timestamp: ago(12),
        read: true,
      },
      {
        id: "MSG-005-4",
        from: "ООО ЛистПром",
        fromRole: "supplier",
        text: "Груз отправлен. Трек-номер: ДЛ-2802149376. Вес брутто 186 кг, 2 места. Ожидаемая дата прибытия на терминал — 18.02.2026. Накладная и акт приёмки в приложении.",
        timestamp: ago(8),
        read: false,
      },
      {
        id: "MSG-005-5",
        from: "Система",
        fromRole: "system",
        text: "Статус заказа ОРД-002 автоматически обновлён на \u00ABОтправлен\u00BB. Ожидаемая дата доставки: 18.02.2026.",
        timestamp: ago(8),
        read: false,
      },
    ],
  },

  // ---- 6. Обсуждение контроля качества с поставщиком (supplier) ----
  {
    id: "CONV-006",
    subject: "Контроль качества — шестерни привода (ОРД-003)",
    channel: "supplier",
    status: "active",
    relatedOrder: "ОРД-003",
    participants: ["Иванов А.С.", "ООО ТочМех"],
    lastMessageAt: ago(4),
    unreadCount: 1,
    messages: [
      {
        id: "MSG-006-1",
        from: "ООО ТочМех",
        fromRole: "supplier",
        text: "Алексей Сергеевич, добрый день. Шестерни по заказу ОРД-003 готовы. Перед отправкой проводим контроль на зубомере. Хотели бы уточнить: достаточно ли нам провести выборочный контроль (каждая 3-я деталь) или нужен 100% контроль всей партии?",
        timestamp: ago(28),
        read: true,
      },
      {
        id: "MSG-006-2",
        from: "Иванов А.С.",
        fromRole: "supplier",
        text: "Добрый день. Учитывая ответственное применение (привод конвейера), прошу провести 100% контроль по следующим параметрам: 1) Профиль зуба — по ГОСТ 9178. 2) Направление зуба. 3) Биение зубчатого венца — не более 0.02 мм. 4) Твёрдость после ТО — HRC 45-50. Протоколы контроля приложите к отгрузке.",
        timestamp: ago(26),
        read: true,
      },
      {
        id: "MSG-006-3",
        from: "ООО ТочМех",
        fromRole: "supplier",
        text: "Понял, выполним 100% контроль по всем параметрам. Ориентировочно контроль займёт 2 дня. Предварительные результаты: первые 4 шестерни — в допуске, HRC 47-48. Вышлю полный протокол после завершения проверки.",
        timestamp: ago(4),
        read: false,
      },
    ],
  },

  // ---- 7. Оператор — помощь с оплатой (operator) ----
  {
    id: "CONV-007",
    subject: "Вопрос по оплате заказа — безопасная сделка",
    channel: "operator",
    status: "active",
    participants: ["Иванов А.С.", "Оператор платформы"],
    lastMessageAt: ago(3),
    unreadCount: 1,
    messages: [
      {
        id: "MSG-007-1",
        from: "Иванов А.С.",
        fromRole: "operator",
        text: "Здравствуйте. Хотел бы уточнить механизм \u00ABБезопасной сделки\u00BB. Если поставщик отправил детали, но они пришли с дефектами — как происходит возврат средств? И в какой срок нужно открыть спор?",
        timestamp: ago(10),
        read: true,
      },
      {
        id: "MSG-007-2",
        from: "Оператор платформы",
        fromRole: "operator",
        text: "Добрый день, Алексей Сергеевич! При использовании \u00ABБезопасной сделки\u00BB средства замораживаются на эскроу-счёте до подтверждения приёмки. Порядок действий при обнаружении дефектов:\n\n1. Откройте спор в карточке заказа (кнопка \u00ABОткрыть спор\u00BB) — в течение 5 рабочих дней после получения.\n2. Приложите фото/видео дефектов и протокол входного контроля.\n3. Поставщик получит уведомление и 3 рабочих дня на ответ.\n4. Если стороны не договорились — подключается арбитраж платформы.\n5. Решение арбитража: возврат средств, частичная компенсация или доработка за счёт поставщика.\n\nСредства разблокируются только после разрешения спора.",
        timestamp: ago(8),
        read: true,
      },
      {
        id: "MSG-007-3",
        from: "Иванов А.С.",
        fromRole: "operator",
        text: "Спасибо за подробное объяснение. А можно ли продлить срок приёмки, если для проверки нужно время (например, установка и испытание детали)?",
        timestamp: ago(6),
        read: true,
      },
      {
        id: "MSG-007-4",
        from: "Оператор платформы",
        fromRole: "operator",
        text: "Да, вы можете продлить срок приёмки до 14 рабочих дней через карточку заказа (кнопка \u00ABПродлить приёмку\u00BB). Если нужен срок больше 14 дней — напишите нам, рассмотрим индивидуально. Рекомендуем указывать необходимость испытаний заранее в условиях заказа.",
        timestamp: ago(3),
        read: false,
      },
    ],
  },

  // ---- 8. Системные уведомления — сводка за неделю (system) ----
  {
    id: "CONV-008",
    subject: "Еженедельная сводка по активности",
    channel: "system",
    status: "resolved",
    participants: ["Иванов А.С.", "Система"],
    lastMessageAt: ago(48),
    unreadCount: 0,
    messages: [
      {
        id: "MSG-008-1",
        from: "Система",
        fromRole: "system",
        text: "Еженедельная сводка (03.02 — 09.02.2026):\n\n\u2022 Новые предложения: 5 (по лотам LOT-001, LOT-005, LOT-009)\n\u2022 Заказы в производстве: 3\n\u2022 Заказы доставлены: 1 (ОРД-004 — ожидает приёмки)\n\u2022 Открытые споры: 1 (ОРД-006)\n\u2022 Лоты без предложений: 1 (LOT-008 — рекомендуем пересмотреть условия)\n\nПерейдите в панель управления для подробной информации.",
        timestamp: ago(120),
        read: true,
      },
      {
        id: "MSG-008-2",
        from: "Система",
        fromRole: "system",
        text: "Еженедельная сводка (10.02 — 14.02.2026):\n\n\u2022 Новые предложения: 3 (по лотам LOT-009, LOT-004)\n\u2022 Заказы в производстве: 2\n\u2022 Заказы отправлены: 1 (ОРД-002)\n\u2022 Заказы ожидают подтверждения: 1 (ОРД-007)\n\u2022 Лоты в черновике: 2 (LOT-006, LOT-011 — не забудьте опубликовать)\n\nСовет: по лоту LOT-008 \u00ABВакуумное литьё\u00BB не поступило предложений. Рекомендуем увеличить бюджет или расширить требования к поставщикам.",
        timestamp: ago(48),
        read: true,
      },
    ],
  },
];

export default MOCK_CONVERSATIONS;
